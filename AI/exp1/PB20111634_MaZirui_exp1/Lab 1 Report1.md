# Lab 1 Report

PB20111623 马子睿

## A^*^算法求解L型锁问题

### 问题描述

* 对于一个$N \times N$的01矩阵，每次可以拨动L型的3个元素使其取反。求出使矩阵中全部元素全为0的最少步数及其对应方案

### 评估函数的选择

* 在本题中，我选择了这样的一个评估函数：

  令$D_1, D_2, ..., D_m$为矩阵中所有的**1值4连通片**（1值4连通片：以上下左右四个方向为1而定义的连通所构成的连通片），其中每个4连通片中的1的个数为$h_1, h_2, ...,h_m$。再设矩阵中每个0上下左右一格内的1值4联通片个数为$R_1, R_2, ..., R_k$，则对于当前版面的评估函数：
  $$
  h = \sum_{i=1}^n\lceil{\frac{h_i}3}\rceil - \sum_{i=1}^kI(R_i \ge3)\times(R_i-2)
  $$
  其中，$I$是一个指示函数，当$R_i \ge 3$时，它为1，否则它为0

  用简单的话来讲，这里的评估函数就等于**每个1值4联通片中的1值数量除以3取上整的和**，减去**一个数字**，**这个数字等于那些被3个联通片包围的0的数量加上被4个联通片包围的0的数量的2倍**

* 可采纳性证明：

  先来证明一个定理：

  > 定理1：对于任意形状的4连通区域，若其中1的个数为n，则取$h=\lceil\frac n3\rceil$是可采纳的

  * 证明：

    1. 若$n \% 3 = 0$，则显然最优的情况就是每三个点组成一个L型，因此这时最少步数肯定为$\lceil\frac n3\rceil$，也就证明了$h \le h^*$
    2. 若$n \%3 = 1或 n \%3 = 2$，则考虑最理想情况，则$\lfloor\frac n3\rfloor$步后肯定还剩余1了（这是因为$\lfloor\frac n3\rfloor \times 3 < n$，那么至少还需要1步来消除所有1，也就是至少需要$\lceil\frac n3\rceil$步解决，也就证明了$h \le h ^*$

    综上所述，定理得证。

  在这个定理基础上，我们再来证明：

  > 定理2：包含任意n个不同的1值4连通片的矩阵，如果每个0只和少于3个1值4连通片4-相邻，那么$\sum_{i=1}^n\lceil{\frac{h_i}3}\rceil$依然是可采纳的。

  * 证明：

    考虑存在8-连通（上下左右，上左、上右、下左、下右）的4连通片，也就是两个四连通片存在对角相邻的情况，这时如果最优路径上需要的话，那么可以利用这个对角相邻，利用相邻处的0，用1步为每一个连通片的最后消除减少1步，总体来说，这两个连通片的消除总步数比他们分别的局部启发式函数（也就是定理1中定义的启发式函数）之和少了一步，但却引入了一个新的1值4连通片（因为根据定理条件，新引入的这个1不可能和任何一个1值4连通片4-相邻）。那么剩余盘面中又至少需要多使用一步来解决这个连通片，因此总的最优步数并没有减少，启发式函数依然是可采纳的。

  证明了上述定理后，我们再来解决以下问题：

  > 定理3：如果存在一个被3个1值4连通片包围的0，那么启发式函数需要减少1；如果存在一个被4个1值4联通片包围的0，那么启发式函数需要减少2。

  * 证明：

    先考虑前一种情况：如果一个0被三个1值4连通片包围，那么一旦最优路径上其中两个连通片需要使用这个0来为两个连通片总步数减少1步，那么新生成的这个1就会被引入另一个连通片中，而最坏情况下，那个连通片中1的总数+1很有可能导致那个连通片中1的总数除以3取上整的值不增加，导致不需要更多步数来解决这个新生成的1。因此总的启发式函数需要减少1。

    再考虑后一种情况：如果一个0被4个1值4连通片包围，那么很显然，那么一旦最优路径上其中两个连通片需要使用这个0来为两个连通片总步数减少1步，新生成的那个1很有可能成为了另外两个联通片减少一步的”垫脚石“（也就是说，另外两个连通片可能也正需要这个位置来为他们的总步数减少1步）。如此一来，这样的1步会为总步数直接减少2步，因此总的启发式函数也应该进行修正，每存在一个这样的0，启发式函数需要减少2.

  综上所述，我们证明了我们的启发式函数式可采纳的。

* 一致性证明：

  在任意$N$状态，要想将其变换为相邻的$N'$状态，其代价为1，再考虑这一次翻转会造成什么影响。我们先拆分这个启发式函数，令$h^{(1)} = \sum_{i=1}^n\lceil{\frac{h_i}3}\rceil$，$h^{(2)} = \sum_{i=1}^kI(R_i \ge3)\times(R_i-2)$。

  * 增加三个1：最坏情况下联通片个数减少1，为1个0增加了两个相邻连通片，这使得$h^{(2)}$增加了2，同时$h^{(1)}$增加了1，因此依然满足$h(N) \le 1 + h(N')$
  * 增加两个1：最坏情况下使1个0的相邻连通片从2增加到4，这使得$h^{(2)}$增加了2，同时可能要增加1个联通片，导致$h^{(1)}$增加1，依然满足$h(N) \le 1 + h(N')$。如果不增加联通片，那么造成这种最坏情况一定是由于这个0对角的一个1将与0相邻的两个0变成了1，如果这两个变成0的1依然处在两个已有连通片中，那么对角的那个1就不可能处在单独的联通片中，否则

## 

|      |      |      |      |
| :--: | :--: | :--: | :--: |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |
|      |      |      |      |